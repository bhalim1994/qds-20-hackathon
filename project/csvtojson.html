<!DOCTYPE html>
<head>
<meta charset="utf-8">

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.0.0/papaparse.min.js"></script>

<style>
body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,
         Ubuntu,Cantarell,"Helvetica Neue",sans-serif; 
       background: white ; }
</style>

<script>

// To access during the demo, call convertedCSV.data[x]
let convertedCSV;

function loadcsv(file) {
  var fr = new FileReader();
  fr.onload = function(e) { 
    convertedCSV = Papa.parse(e.target.result, { dynamicTyping: true }) ;
    if ( convertedCSV.errors.length ) alert ( convertedCSV.errors ) ;
    console.log(convertedCSV) ;
  }
  fr.readAsText(file);
}

function download() {
  addhtml("<a href='data:text/plain;charset=utf-8,"+
	encodeURIComponent(JSON.stringify(data,null,'\t'))+
    "' download='"+"data.json"+"' id='savelink'></a>") ;
  document.getElementById('savelink').click() ;
}

</script>

</head>

<body>

<h1>CSV Import and JSON Export for QDS20</h1>

<p>The conversion of the CSV file was parsed using
<a href=https://www.papaparse.com/>PapaParse</a>.

<p>After you select a CSV file: <input type="file"  onchange="loadcsv(this.files[0])"/>
the script reads the file and extracts the data

<p>You can then <input type="button" onclick='download()' id="save" value="Save"/> the JSON-format file.

</body>

</html>
